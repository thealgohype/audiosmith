import React, { useState } from 'react';
import '../styles/Main.css'; // Ensure this CSS file includes the new styles

export const Main = () => {
  const [recording, setRecording] = useState(false);
  const [mediaRecorder, setMediaRecorder] = useState(null);
  const [transcription, setTranscription] = useState('');
  const [silenceTimer, setSilenceTimer] = useState(null);
  const [model, setModel] = useState('chatgpt');
  const [inputText, setInputText] = useState('');

  const startRecording = async () => {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      const recorder = new MediaRecorder(stream);
      let chunks = [];

      recorder.ondataavailable = e => {
        chunks.push(e.data);
        if (silenceTimer) clearTimeout(silenceTimer);
        setSilenceTimer(setTimeout(stopRecording, 2000));
      };

      recorder.onstop = async () => {
        const blob = new Blob(chunks, { type: 'audio/mp3' });
        chunks = [];
        submitAudio(blob);
      };

      recorder.start();
      setMediaRecorder(recorder);
      setRecording(true);
    } catch (error) {
      console.error('Error accessing the microphone:', error);
    }
  };

  const stopRecording = () => {
    if (mediaRecorder && mediaRecorder.state !== 'inactive') {
      mediaRecorder.stop();
      setRecording(false);
    }
  };

  const submitAudio = (audioBlob) => {
    const body = new FormData();
    body.append('file', audioBlob);
    body.append("language","english")
    body.append('response_format', 'json');

    fetch('https://api.lemonfox.ai/v1/audio/transcriptions', {
      method: 'POST',
      headers: {
        'Authorization': 'Bearer YxUl6ozyUIRZxIDnnFld8P8IhRGiiQoM'
      },
      body: body
    })
    .then(response => response.json())
    .then(data => {
      setTranscription(data['text']);
    })
    .catch(error => {
      console.error('Error:', error);
    });
  };

  const handleSend = () => {
    const payload = {
      text: inputText,
      model: model
    };

    // <<<<-------------------Data send to backend ---------------->>>>
    fetch('YOUR_BACKEND_ENDPOINT', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(payload),
    })
    .then(response => response.json())
    .then(data => {
      console.log('Success:', data);
    })
    .catch((error) => {
      console.error('Error:', error);
    });
  };

  return (
    <div className="main-container bg-gray-900 text-white h-screen flex">
      <aside className="sidebar w-64 bg-gray-800 p-4">
        <select className="model-selector block w-full p-2 mb-4 bg-gray-700 text-white border border-gray-600 rounded" value={model} onChange={(e) => setModel(e.target.value)}>
          <option value="chatgpt">ChatGPT</option>
          <option value="gemini">Gemini</option>
          <option value="claude">Claude</option>
          <option value="gpt4">GPT-4</option>
        </select>
      </aside>
      <section className="chat-container flex-grow flex flex-col p-4">
      
        <div className="chat-display overflow-y-auto mb-4 flex-grow">
          <p className="text-lg">{transcription}</p>
        </div>
        <div className="input-area flex items-center">
          <input type="text" className="search-bar flex-grow mr-2 p-2 bg-gray-700 border border-gray-600 rounded" placeholder="Type here..." value={inputText} onChange={(e) => setInputText(e.target.value)} />
          <button className={`mic-button px-4 py-2 rounded text-white ${recording ? 'bg-red-500' : 'bg-green-500'}`} onClick={recording ? stopRecording : startRecording}>
            {recording ? 'Stop' : 'Speak'}
          </button>
          <button className="send-button ml-2 px-4 py-2 rounded bg-blue-500 text-white" onClick={handleSend}>
            Send
          </button>
        </div>
        {recording && <div className="voice-bars">
          <div className="bar"></div>
          <div className="bar"></div>
          <div className="bar"></div>
          <div className="bar"></div>
          <div className="bar"></div>
        </div>}
      </section>
    </div>
  );
};





// <<<<<<<---------------------------------------------THIRD-------------------------------------------->>>>>
// import React, { useState } from 'react';
// import '../styles/Main.css';

// export const Main = () => {
//   const [recording, setRecording] = useState(false);
//   const [mediaRecorder, setMediaRecorder] = useState(null);
//   const [transcription, setTranscription] = useState('');
//   const [silenceTimer, setSilenceTimer] = useState(null);
//   const [model, setModel] = useState('chatgpt');

//   const startRecording = async () => {
//     try {
//       const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
//       const recorder = new MediaRecorder(stream);
//       let chunks = [];

//       recorder.ondataavailable = e => {
//         chunks.push(e.data);
//         if (silenceTimer) clearTimeout(silenceTimer);
//         setSilenceTimer(setTimeout(stopRecording, 2000));
//       };

//       recorder.onstop = async () => {
//         const blob = new Blob(chunks, { type: 'audio/mp3' });
//         chunks = [];
//         submitAudio(blob);
//       };

//       recorder.start();
//       setMediaRecorder(recorder);
//       setRecording(true);
//     } catch (error) {
//       console.error('Error accessing the microphone:', error);
//     }
//   };

//   const stopRecording = () => {
//     if (mediaRecorder && mediaRecorder.state !== 'inactive') {
//       mediaRecorder.stop();
//       setRecording(false);
//     }
//   };

//   const submitAudio = (audioBlob) => {
//     const body = new FormData();
//     body.append('file', audioBlob);
//     body.append('response_format', 'json');

//     fetch('https://api.lemonfox.ai/v1/audio/transcriptions', {
//       method: 'POST',
//       headers: {
//         'Authorization': 'Bearer YxUl6ozyUIRZxIDnnFld8P8IhRGiiQoM'
//       },
//       body: body
//     })
//     .then(response => response.json())
//     .then(data => {
//       setTranscription(data['text']);
//     })
//     .catch(error => {
//       console.error('Error:', error);
//     });
//   };

//   return (
//     <div className="main-container bg-gray-900 text-white h-screen flex">
//       <aside className="sidebar w-64 bg-gray-800 p-4">
//         <select className="model-selector block w-full p-2 mb-4 bg-gray-700 text-white border border-gray-600 rounded" value={model} onChange={(e) => setModel(e.target.value)}>
//           <option value="chatgpt">ChatGPT</option>
//           <option value="gemini">Gemini</option>
//           <option value="claude">Claude</option>
//           <option value="gpt4">GPT-4</option>
//         </select>
//       </aside>
//       <section className="chat-container flex-grow p-4 relative">
//         <div className="chat-display overflow-y-auto mb-4">
//           <p className="text-lg">{transcription}</p>
//         </div>
//         <div className="input-area flex items-center">
//           <input type="text" className="search-bar flex-grow mr-2 p-2 bg-gray-700 border border-gray-600 rounded" placeholder="Type here..." />
//           <button className={`mic-button px-4 py-2 rounded text-white ${recording ? 'bg-red-500' : 'bg-green-500'}`} onClick={recording ? stopRecording : startRecording}>
//             {recording ? 'Stop' : 'Speak'}
//           </button>
//         </div>
//         {recording && <div className="listening-animation fixed top-0 left-0 right-0 h-1/2 bg-black bg-opacity-60 flex justify-center items-center">
//           <div className="pulse"></div>
//         </div>}
//       </section>
//     </div>
//   );
// };


// -------------------------------SECOND------------------------------>>>>

// export const Main = () => {
//   const [recording, setRecording] = useState(false);
//   const [mediaRecorder, setMediaRecorder] = useState(null);
//   const [transcription, setTranscription] = useState('');
//   const [silenceTimer, setSilenceTimer] = useState(null);
//   const [model, setModel] = useState('chatgpt');

//   const startRecording = async () => {
//     try {
//       const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
//       const recorder = new MediaRecorder(stream);
//       let chunks = [];

//       recorder.ondataavailable = e => {
//         chunks.push(e.data);
//         if (silenceTimer) clearTimeout(silenceTimer);
//         setSilenceTimer(setTimeout(stopRecording, 2000));
//       };

//       recorder.onstop = async () => {
//         const blob = new Blob(chunks, { type: 'audio/mp3' });
//         chunks = [];
//         submitAudio(blob);
//       };

//       recorder.start();
//       setMediaRecorder(recorder);
//       setRecording(true);
//     } catch (error) {
//       console.error('Error accessing the microphone:', error);
//     }
//   };

//   const stopRecording = () => {
//     if (mediaRecorder && mediaRecorder.state !== 'inactive') {
//       mediaRecorder.stop();
//       setRecording(false);
//     }
//   };

//   const submitAudio = (audioBlob) => {
//     const body = new FormData();
//     body.append('file', audioBlob);
//     body.append('response_format', 'json');

//     fetch('https://api.lemonfox.ai/v1/audio/transcriptions', {
//       method: 'POST',
//       headers: {
//         'Authorization': 'Bearer YxUl6ozyUIRZxIDnnFld8P8IhRGiiQoM'
//       },
//       body: body
//     })
//     .then(response => response.json())
//     .then(data => {
//       setTranscription(data['text']);
//     })
//     .catch(error => {
//       console.error('Error:', error);
//     });
//   };

//   return (
//     <div className="main-container bg-gray-900 text-white h-screen flex">
//       <aside className="sidebar w-64 bg-gray-800 p-4">
//         <select className="model-selector block w-full p-2 mb-4 bg-gray-700 text-white border border-gray-600 rounded" value={model} onChange={(e) => setModel(e.target.value)}>
//           <option value="chatgpt">ChatGPT</option>
//           <option value="gemini">Gemini</option>
//           <option value="claude">Claude</option>
//           <option value="gpt4">GPT-4</option>
//         </select>
//       </aside>
//       <section className="chat-container flex-grow p-4 relative">
//         <div className="chat-display overflow-y-auto mb-4">
//           <p className="text-lg">{transcription}</p>
//         </div>
//         <div className="input-area flex items-center">
//           <input type="text" className="search-bar flex-grow mr-2 p-2 bg-gray-700 border border-gray-600 rounded" placeholder="Type here..." />
//           <button className={`mic-button px-4 py-2 rounded text-white ${recording ? 'bg-red-500' : 'bg-green-500'}`} onClick={recording ? stopRecording : startRecording}>
//             {recording ? 'Stop' : 'Speak'}
//           </button>
//         </div>
//         {recording && <div className="listening-animation fixed top-0 left-0 right-0 h-1/2 bg-black bg-opacity-60 flex justify-center items-center text-xl">
//           <p>Listening...</p>
//         </div>}
//       </section>
//     </div>
//   );
// };

// -----------------------------------first--------------------------------------------------->>>>
// import React, { useState, useEffect } from 'react';
// import '../styles/Main.css'; // Ensure you have a Main.css file with the necessary styles

// export const Main = () => {
//   const [recording, setRecording] = useState(false);
//   const [mediaRecorder, setMediaRecorder] = useState(null);
//   const [spokenText, setSpokenText] = useState('');
//   const [transcription, setTranscription] = useState('');
//   const [silenceTimer, setSilenceTimer] = useState(null);
//   const [model, setModel] = useState('chatgpt'); 

//   const startRecording = async () => {
//     try {
//       const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
//       const recorder = new MediaRecorder(stream);
//       let chunks = [];

//       recorder.ondataavailable = e => {
//         chunks.push(e.data);
//         if (silenceTimer) clearTimeout(silenceTimer);
//         setSilenceTimer(setTimeout(stopRecording, 2000)); // Stops recording after 2 seconds of silence
//       };

//       recorder.onstop = async () => {
//         const blob = new Blob(chunks, { type: 'audio/mp3' });
//         chunks = [];
//         submitAudio(blob);
//       };

//       recorder.start();
//       setMediaRecorder(recorder);
//       setRecording(true);
//       setSpokenText('Recording...');
//     } catch (error) {
//       console.error('Error accessing the microphone:', error);
//     }
//   };

//   const stopRecording = () => {
//     if (mediaRecorder && mediaRecorder.state !== 'inactive') {
//       mediaRecorder.stop();
//       setRecording(false);
//       setSpokenText('Stopped recording.');
//       if (silenceTimer) clearTimeout(silenceTimer);
//     }
//   };

//   const submitAudio = (audioBlob) => {
//     const body = new FormData();
//     body.append('file', audioBlob);
//     body.append('language', 'english'); 
//     body.append('response_format', 'json');

//     fetch('https://api.lemonfox.ai/v1/audio/transcriptions', {
//       method: 'POST',
//       headers: {
//         'Authorization': 'Bearer YxUl6ozyUIRZxIDnnFld8P8IhRGiiQoM'
//       },
//       body: body
//     })
//     .then(response => response.json())
//     .then(data => {
//       setTranscription(data['text']);
//       setSpokenText('');
//     })
//     .catch(error => {
//       console.error('Error:', error);
//     });
//   };

//   return (
//     <div className="main-container">
//       <aside className="sidebar">
//         <select className="model-selector" value={model} onChange={(e) => setModel(e.target.value)}>
//           <option value="chatgpt">ChatGPT</option>
//           <option value="gemini">Gemini</option>
//           <option value="claude">Claude</option>
//           <option value="gpt4">GPT-4</option>
//         </select>
//       </aside>
//       <section className="chat-container">
//         <div className="chat-display">
//           <p className="text-lg">{spokenText}</p>
//           <h2 className="text-xl">{transcription}</h2>
//         </div>
//         <div className="input-area">
//           <input type="text" className="search-bar" placeholder="Type here..." />
//           <button className={`mic-button ${recording ? 'bg-red-500' : 'bg-green-500'} animate-pulse`} onClick={recording ? stopRecording : startRecording}>
//             {recording ? 'Stop' : 'Speak'}
//           </button>
//         </div>
//         <div className={`listening-animation ${recording ? 'active' : ''}`}></div>
//       </section>
//     </div>
//   );
// };
// import React, { useState } from 'react';
// import '../styles/Main.css'; // Ensure this CSS file includes the new styles

// export const Main = () => {
//   const [recording, setRecording] = useState(false);
//   const [mediaRecorder, setMediaRecorder] = useState(null);
//   const [transcription, setTranscription] = useState('');
//   const [silenceTimer, setSilenceTimer] = useState(null);
//   const [model, setModel] = useState('chatgpt');
//   const [inputText, setInputText] = useState('');

//   const startRecording = async () => {
//     try {
//       const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
//       const recorder = new MediaRecorder(stream);
//       let chunks = [];

//       recorder.ondataavailable = e => {
//         chunks.push(e.data);
//         if (silenceTimer) clearTimeout(silenceTimer);
//         setSilenceTimer(setTimeout(stopRecording, 2000));
//       };

//       recorder.onstop = async () => {
//         const blob = new Blob(chunks, { type: 'audio/mp3' });
//         chunks = [];
//         submitAudio(blob);
//       };

//       recorder.start();
//       setMediaRecorder(recorder);
//       setRecording(true);
//     } catch (error) {
//       console.error('Error accessing the microphone:', error);
//     }
//   };

//   const stopRecording = () => {
//     if (mediaRecorder && mediaRecorder.state !== 'inactive') {
//       mediaRecorder.stop();
//       setRecording(false);
//     }
//   };

//   const submitAudio = (audioBlob) => {
//     const body = new FormData();
//     body.append('file', audioBlob);
//     body.append("language","english")
//     body.append('response_format', 'json');

//     fetch('https://api.lemonfox.ai/v1/audio/transcriptions', {
//       method: 'POST',
//       headers: {
//         'Authorization': 'Bearer YxUl6ozyUIRZxIDnnFld8P8IhRGiiQoM'
//       },
//       body: body
//     })
//     .then(response => response.json())
//     .then(data => {
//       setTranscription(data['text']);
//     })
//     .catch(error => {
//       console.error('Error:', error);
//     });
//   };

//   const handleSend = () => {
//     const payload = {
//       text: inputText,
//       model: model
//     };

//     // <<<<-------------------Data send to backend ---------------->>>>
//     fetch('YOUR_BACKEND_ENDPOINT', {
//       method: 'POST',
//       headers: {
//         'Content-Type': 'application/json',
//       },
//       body: JSON.stringify(payload),
//     })
//     .then(response => response.json())
//     .then(data => {
//       console.log('Success:', data);
//     })
//     .catch((error) => {
//       console.error('Error:', error);
//     });
//   };

//   return (
//     <div className="main-container bg-gray-900 text-white h-screen flex">
//       <aside className="sidebar w-64 bg-gray-800 p-4">
//         <select className="model-selector block w-full p-2 mb-4 bg-gray-700 text-white border border-gray-600 rounded" value={model} onChange={(e) => setModel(e.target.value)}>
//           <option value="chatgpt">ChatGPT</option>
//           <option value="gemini">Gemini</option>
//           <option value="claude">Claude</option>
//           <option value="gpt4">GPT-4</option>
//         </select>
//       </aside>
//       <section className="chat-container flex-grow flex flex-col p-4">
//         <div className="chat-display overflow-y-auto mb-4 flex-grow">
//           <p className="text-lg">{transcription}</p>
//         </div>
//         <div className="input-area flex items-center">
//           <input type="text" className="search-bar flex-grow mr-2 p-2 bg-gray-700 border border-gray-600 rounded" placeholder="Type here..." value={inputText} onChange={(e) => setInputText(e.target.value)} />
//           <button className={`mic-button px-4 py-2 rounded text-white ${recording ? 'bg-red-500' : 'bg-green-500'}`} onClick={recording ? stopRecording : startRecording}>
//             {recording ? 'Stop' : 'Speak'}
//           </button>
//           <button className="send-button ml-2 px-4 py-2 rounded bg-blue-500 text-white" onClick={handleSend}>
//             Send
//           </button>
//         </div>
//       </section>
//     </div>
//   );
// };
